<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>여러개 마커 표시하기</title>
</head>
<body>

<div id="map" style="width:100%;height:350px;"></div>

<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=041b078bdcd856906e02df7bc3f074ba"></script>
<script>
  var mapContainer = document.getElementById('map');
  var mapOption = {
    center: new kakao.maps.LatLng(36.566535, 127.9779692),
    level: 12
  };

  var map = new kakao.maps.Map(mapContainer, mapOption);
  var clickCount = 0;
  var markersE = [];
  var markersI = [];
  var markersS = [];
  var markersN = [];

  function createMarkers(positions, category) {
    var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/places_category.png";

    for (var i = 0; i < positions.length; i++) {
      var imageSize = new kakao.maps.Size(24, 35);
      var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

      var marker = new kakao.maps.Marker({
        position: new kakao.maps.LatLng(positions[i].lat, positions[i].lng),
        title: positions[i].title,
        image: markerImage
      });

      marker.setMap(map);

      // 해당 카테고리에 따라 마커들을 그룹화합니다.
      if (category === 'E') {
        markersE.push(marker);
      } else if (category === 'I') {
        markersI.push(marker);
      } else if (category === 'S') {
        markersS.push(marker);
      } else if (category === 'N') {
        markersN.push(marker);
      }

      kakao.maps.event.addListener(marker, 'click', function() {
        clickCount++;
        if (clickCount % 2 === 0) {
          if (this.infowindow) {
            this.infowindow.close();
            this.infowindow = null;
          }
        } else {
          this.infowindow = new kakao.maps.InfoWindow({
            content: this.getTitle()
          });

          this.infowindow.open(map, this);
        }
      });
    }
  }

  // E 카테고리의 마커 생성
  fetch('output1.json')
          .then(response => response.json())
          .then(positionsE => {
            createMarkers(positionsE, 'E');

            // I 카테고리의 마커 생성
            fetch('output2.json')
                    .then(response => response.json())
                    .then(positionsI => {
                      createMarkers(positionsI, 'I');

                      // S 카테고리의 마커 생성
                      fetch('output3.json')
                              .then(response => response.json())
                              .then(positionsS => {
                                createMarkers(positionsS, 'S');

                                // N 카테고리의 마커 생성
                                fetch('output4.json')
                                        .then(response => response.json())
                                        .then(positionsN => {
                                          createMarkers(positionsN, 'N');
                                        })
                                        .catch(error => console.error('Error:', error));
                              })
                              .catch(error => console.error('Error:', error));
                    })
                    .catch(error => console.error('Error:', error));
          })
          .catch(error => console.error('Error:', error));
</script>
</body>
</html>
